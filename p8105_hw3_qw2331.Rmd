---
title: "p8105_hw3_qw2331"
output: github_document
---

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.coutinuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

**Load the `instacart` data**
```{r}
data("instacart")
instacart_df <- instacart
```

**A brief description about `instacart`**
```{r}
# Quickly overview
summary(instacart_df)
```
+ This dataset contains ``r nrow(instacart_df)`` observations and ``r ncol(instacart_df)`` variables.  
+ Among the variables, there are `11` integer variables and `4` character variables.  
+ Among all the variables, which are ``r names(instacart_df)``, respectively, the key variables are:  
  + `order_id` represents an order identifier;  
  + `product_id` represents a product identifier;    
  + `user_id` represents a customer identifier;  
  + `aisle_id` represents an aisle identifier;   
  + `department_id` represents a department identifier.    
+ Illustrative examples of observations are showing below:     
```{r, message = FALSE}
# Illustrative examples
items_day_p <- 
  instacart_df %>% 
  filter(aisle %in% c("yogurt", "cream", "fresh fruits")) %>% 
  group_by(aisle, order_dow) %>% 
  summarize(n_purchase = n()) %>% 
  ggplot(aes(x = order_dow, y = n_purchase, color = aisle)) + 
  geom_point(alpha = .5) + 
  geom_smooth(se = FALSE, size = .5) + 
  labs(
    x = "Day of the week",
    y = "Purchased quantity",
    caption = "Data from p8105 package"
  )

items_day_p
```

+ The plot shows that:  
  + `Fresh furits` have the highest sales volume comparing with the other two;  
  + In generally, people will shop online using Instacart on Sunday.

**Answer the following questions**  
+ How many aisles are there, and which aisles are the most items ordered from?
```{r}
n_items_of_aisle <- 
  instacart_df %>% 
  count(aisle, name = "n_items") %>% 
  arrange(desc(n_items))

n_items_of_aisle
```
There are ``r length(unique(pull(instacart_df, aisle)))`` aisles in this dataset;
Most items are ordered from the aisle `fresh vegetables`.

+ Make a plot that shows the number of items ordered in each aisle, limiting this to aisle with more than 10000 items ordered. Arrange aisles sensibly, and organize your plot so others can read it.
```{r, warning = FALSE, fig.width = 9}
n_items_of_aisle %>% 
  filter(n_items > 10000) %>% 
  mutate(
    aisle = fct_reorder(aisle, n_items)
  ) %>% 
  ggplot(aes(x = n_items, y = aisle, fill = aisle)) +
  geom_bar(
    stat = "identity", 
    show_guide = FALSE
    ) + 
  geom_text(aes(label = n_items), size = 2.5, hjust = 0) + 
  labs(
    x = "Number of items",
    y = "Aisle",
    title = "Number of items ordered in each aisle",
    caption = "Data from p8105 package"
  )
```

+ Make a table showing the three most popular items in each of the aisles "baking ingredients", "dog food care", and "packaged vegetables fruits". Include the number of times each item is ordered in your table.
```{r, message = FALSE}
instacart_df %>% 
  filter(
    aisle %in% 
      c("baking ingredients", "dog food care", "packaged vegetables fruits")
  ) %>% 
  group_by(aisle, product_name) %>%
  summarize(number_items = n()) %>% 
  arrange(desc(number_items)) %>% 
  do(head(., n = 3)) %>% 
  knitr::kable()
```

+ Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week; format this table for human readers (i.e. produce a 2 * 7 table)
```{r, message = FALSE}
instacart_df %>% 
  filter(
    product_name %in%
      c("Pink Lady Apples", "Coffee Ice Cream")
  ) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(
    mean_hour = mean(order_hour_of_day)
  ) %>% 
  mutate(
    order_dow = weekdays(Sys.Date() + 0:6)[order_dow + 1]
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) %>% 
  knitr::kable(digits = 1)
```


## Problem 2

**Load the `BRFSS` data**
```{r}
data("brfss_smart2010")
brfss_df <- brfss_smart2010
```

**Do some data cleaning**
```{r}
brfss_df <- 
  brfss_df %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  mutate(
    response = factor(response,
                      levels = c("Poor", "Fair", "Good", "Very good", "Excellent"),
                      ordered = TRUE)
  )
```

